{% extends 'vault/base.html' %}
{% load static %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold text-primary">Your Credentials</h4>
    <div class="d-flex gap-2">
        <a href="{% url 'profile' %}" class="btn btn-outline-secondary btn-sm">
          <i class="bi bi-person-circle me-1"></i> Profile
        </a>

        <a href="{% url 'add_credential' %}" class="btn btn-sm btn-success shadow-sm px-4 py-2">
            <i class="bi bi-plus-circle"></i> Add
        </a>
    </div>
</div>

<form method="get" class="mb-4" id="search-form">
    <div class="input-group">
        <input type="text" name="q" placeholder="Search..." class="form-control rounded-start" id="search-input" value="{{ search_query }}">
        <button class="btn btn-outline-primary rounded-end" type="submit">
            <i class="bi bi-search"></i> Search
        </button>
    </div>
</form>

<div class="row" id="credential-results">
    {% include 'partials/credential_list.html' %}
</div>

<!-- Bootstrap Icons CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<!-- AJAX Search & Toggle Script -->
<script>
  const searchInput = document.getElementById('search-input');
  const resultsDiv = document.getElementById('credential-results');

  searchInput.addEventListener('input', () => {
    fetch(`?q=${encodeURIComponent(searchInput.value)}`, {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
    .then(response => response.json())
    .then(data => {
      resultsDiv.innerHTML = data.html;
    });
  });

  document.addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('btn-toggle-password')) {
      const btn = e.target;
      const span = btn.previousElementSibling;
      const isVisible = span.classList.contains('visible-password');

      if (isVisible) {
        span.textContent = '********';
        span.classList.remove('visible-password');
        btn.textContent = 'Show';
      } else {
        span.textContent = span.dataset.password;
        span.classList.add('visible-password');
        btn.textContent = 'Hide';
      }
    }
  });
</script>

{% endblock %}
